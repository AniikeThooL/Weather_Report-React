"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4456],{31181:function(e,t,n){n.d(t,{z:function(){return g}});var l=n(67294),i=n(50361),a=n.n(i),o=n(36188),r=n(32751),u=n(87598),d=n(66830),s=n(42209),c=n(14484),v=n(51143);let p=(e,t)=>{let n="".concat(s.apiBaseUrl,"/api/v1/image/pinned/").concat(e);return(0,u.uz)(n,{},{headers:{"X-CSRF-Token":t}})},g=()=>{let{token:e}=(0,c.EC)(),t=(0,r.Z)(),n=(0,o.D)({mutationFn:t=>{let{id:n}=t;return p(n,e)},onSuccess:(e,n)=>{let{id:l}=n,i=t.mutate(d.O.Images(),e=>e.pinterest_filter&&1===(0,v.w2)(e.pinterest_filter),t=>{let n=t.results.findIndex(e=>e.id===l);if(t.results[n]){let l=a()(t),i=(0,v.w2)(l.results[n].pinterest_viewed_user_remaining,0),o=(0,v.w2)(l.results[n].pinterest_counts_required,0)-e.count,r=l.pinterest_totals.user_remaining;return l.results[n].pinterest_viewed_user_remaining=Math.max(0,o),l.results[n].pinterest_counts_required=Math.max(0,o),l.pinterest_totals.user_remaining=r-(i-Math.max(0,o)),0===o&&(l.results.splice(n,1),l.total-=1),l}return null});return i.commit(),{transaction:i}},onError:(e,t,n)=>{let{transaction:l}=n;l.rollback()}});return{set:(0,l.useCallback)(e=>n.mutate({id:e}),[n])}}},41383:function(e,t,n){n.d(t,{BD:function(){return _},Ij:function(){return y},JP:function(){return k},RW:function(){return g},U9:function(){return h},Vc:function(){return m},rN:function(){return b},tj:function(){return f}});var l=n(58261),i=n.n(l),a=n(274),o=n(7517),r=n(13155),u=n(49785),d=n(31972),s=n(7294),c=n(65118),v=n(29428),p=n(68365);let g=6,f=(e,t,n)=>{var l;let i=e.display_image_width||e.width||1,a=e.display_image_height||e.height||1;return(null==e?void 0:null===(l=e.metadata)||void 0===l?void 0:l.isPrint)&&n<p.tu?2*g+a/i*(t-2*g):a/i*t},h=(e,t)=>{let[n,l]=(0,d.pF)(e.width,e.height,e.units);return t/(n/l)},m=(e,t,n)=>{let l=(e,t)=>{let n=new u.Z(e);return t&&n.pushFilter(t,"tags_or"),n.toString()},i=[];return t&&i.push({label:"Add-on",queries:{tags:"$addons",topic_group:"$addons"},pathQuery:l(a.X3)}),"layerphoto"===e?i.push({label:"Photo",queries:{tags_or:"$jpegtiff"},pathQuery:l(a.bj,"$jpegtiff")},{label:"PSD",queries:{tags_or:"$psd"},pathQuery:l(a.bj,"$psd")}):"vector"===e?i.push({label:"Vector",queries:{tags_or:"$vector"},pathQuery:l(a.bj,"$vector")}):"png"===e?i.push({label:"PNG",queries:{tags_or:"$png"},pathQuery:l(a.bj,"$png")}):"docx"===e?i.push({label:"Word",queries:{tags_or:"$docxpdf"},pathQuery:l(a.bj,"$docxpdf")}):"pdf"===e?i.push({label:"PDF",queries:{tags_or:"$pdf"},pathQuery:l(a.bj,"$pdf")}):n?i.push({label:"Font",queries:{tags:"$fonts",topic_group:"$fonts"},pathQuery:l(a.lH)}):i.push({label:"Photo",queries:{tags_or:"$jpegtiff"},pathQuery:l(a.bj,"$jpegtiff")}),i},b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=o.sp.find(t=>e.includes(t));return t&&o.E1[t]?o.E1[t]:null},_=function(e){var t,n,l,a;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(o){let t=[];if(null==r?void 0:r.path){let e=new u.Z(r.path).pathParts.filter(e=>"group"===e.type&&e.id!==o.id).map(e=>e.id);e.length>0&&t.push(...e)}let n=u.Z.createPathFromTopicEntity(o,null,t);return w(n,e),"/create/design/".concat(e.design_id,"?").concat(i()({path:n.stringify(),tid:(null==e?void 0:null===(a=e.metadata)||void 0===a?void 0:a.templateId)||(null==e?void 0:e.id)},s.j1))}let d=b(null==e?void 0:null===(t=e.metadata)||void 0===t?void 0:t.createToolTopics),c=(null==e?void 0:null===(n=e.metadata)||void 0===n?void 0:n.defaultCategoryId)||void 0,v=new u.Z;return(null==d?void 0:d.id)&&v.push(d.id),c&&v.push(c,"topic"),w(v,e),"/create/design/".concat(e.design_id,"?").concat(i()({path:v.length()?v.stringify():null,tid:(null==e?void 0:null===(l=e.metadata)||void 0===l?void 0:l.templateId)||(null==e?void 0:e.id)},s.j1))},w=(e,t)=>{var n,l,i,a;(null===(l=t.metadata)||void 0===l||null===(n=l.createToolTopics)||void 0===n||!n.includes(r.CREATE_REMIX_TAG))&&((null==t?void 0:null===(i=t.metadata)||void 0===i?void 0:i.design_page_count)>1?e.set(t.id,"pages"):(null==t?void 0:null===(a=t.metadata)||void 0===a?void 0:a.hasSetGroup)&&e.set(t.id,"set"))},y=e=>[(null==e?void 0:e.display_image_width)||(null==e?void 0:e.width)||1,(null==e?void 0:e.display_image_height)||(null==e?void 0:e.height)||1],k=async(e,t)=>{try{let n=await (0,v.ny)(e.uid,e.id,t);(null==n?void 0:n.url)&&(0,c.O)(n.url)}catch(e){console.log(e)}}},49453:function(e,t,n){var l=n(67294),i=n(40144),a=n(16550),o=n(50361),r=n.n(o),u=n(10974),d=n(95448),s=n(96165),c=n(62359),v=n(20419),p=n(32360),g=n(14484),f=n(33818),h=n(66830),m=n(31181),b=n(64739),_=n(68365),w=n(34050),y=n(23555),k=n(228),C=n(8811);let T={};t.Z=(e,t,n,o)=>{var D,j;let{data:F}=(0,g.aF)(),$=(0,g.EC)(),x=$.isReady&&$.isLoggedIn,{data:q}=(0,b.Z0)(x),{activeTeam:P}=(0,C.Z)(),{showUpgradeModal:E,showFreeSignupThrottledModal:Z}=(0,y.Z)(),{setOpen:R}=(0,u.Z)(),{setOpen:S}=(0,d.Z)(),I=(0,a.k6)(),Q=(0,p.R)(),{showRawpixelTeam:B}=(0,s.ZP)(),L=(0,c.Z)(_._y),{openSignupModal:M,closeModal:N}=(0,v.ZP)(),[O,A]=(0,l.useState)(!1),[G,z]=(0,l.useState)(),[H,U]=(0,l.useState)(!1),[X,V]=(0,l.useState)(),W=!!B&&!!(null==F?void 0:null===(D=F.access)||void 0===D?void 0:D.show_rawpixel_team),J=l.useMemo(()=>{var t;return null===(t=e||[])||void 0===t?void 0:t.filter(e=>null==e?void 0:e.id).map(e=>null==e?void 0:e.id)},[e]),{data:K=T}=(0,f.rc)("image",J,J.length>0&&!o),{set:Y}=(0,f.sj)(),{set:ee}=(0,m.z)(),et=(0,i.NL)(),en=l.useCallback(e=>{if(!L&&!W){null==e||e.preventDefault(),A(!0);return}},[W,L]),el=l.useCallback(e=>{if(!L&&!W){e.preventDefault(),A(!0);return}},[L,W]),ei=l.useCallback((e,t,l)=>{if(n){n(e,t,l);return}if("image"===e.type){et.setQueryData(h.O.ImageLocal({id:e.id}),{image:r()(e),placeHolderSrc:t});return}"template"===e.type&&en(l),"design"===e.type&&el(l)},[n,et,en,el]),ea=l.useCallback((e,t,n)=>{if(F&&F.uid>0)Y(F.uid,"image",t,n);else{var l,i;(null==F?void 0:null===(i=F.website_status)||void 0===i?void 0:null===(l=i.throttle_free_signup)||void 0===l?void 0:l.enabled)?Z(!0):M()}},[F,Y,M,Z]),eo=l.useCallback(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if((null==F?void 0:F.uid)>0){e.stopPropagation(),e.preventDefault();let a=l.createRef();a.current=e.currentTarget,R(a,t,n,i)}else{var a,o;(null==F?void 0:null===(o=F.website_status)||void 0===o?void 0:null===(a=o.throttle_free_signup)||void 0===a?void 0:a.enabled)?Z(!0):M()}},[R,null==F?void 0:F.uid,M,Z,null==F?void 0:F.website_status]),er=l.useCallback((e,t,n)=>{e.stopPropagation(),e.preventDefault();let i=l.createRef();i.current=e.currentTarget,S(i,t,n)},[S]),eu=l.useCallback((e,n,l,i)=>{if(F&&F.uid>0){if(e.stopPropagation(),e.preventDefault(),"project"!==l)return;let{id:a}=t;Q(a,[{type:w.Uu[n.type],id:n.id}],"delete",i)}},[F,Q,t]),ed=l.useCallback((e,t)=>{F&&F.uid>0&&ee(t)},[F,ee]),es=l.useCallback(e=>{if(!L&&!W){null==e||e.preventDefault(),A(!0);return}},[W,L]),ec=l.useCallback((t,n)=>{let l=e.find(e=>e.id===n);if(l){if(F&&F.uid>0){var i,a,o,r,u,d,s,c;!F.is_free||F.free_premium_active||(null==l?void 0:null===(i=l.metadata)||void 0===i?void 0:i.isFreeLicense)||(null==l?void 0:null===(a=l.metadata)||void 0===a?void 0:a.isCC0License)?W||!F.is_free||F.free_premium_active||null==l||null===(o=l.metadata)||void 0===o||!o.isFreeLicense||(null==l?void 0:null===(r=l.metadata)||void 0===r?void 0:r.isCC0License)||(null==q?void 0:null===(u=q.limits)||void 0===u?void 0:u.unlimited)||!((null==q?void 0:null===(d=q.limits)||void 0===d?void 0:d.remaining)<=0)||(null==q?void 0:null===(c=q.limits)||void 0===c?void 0:null===(s=c.ids)||void 0===s?void 0:s.includes(null==l?void 0:l.id))?z(l):E({feature:k.HN,upgradeBoxType:"black"}):E({feature:k.D8,upgradeBoxType:"black",image:l})}else I.push("/user/register?destination=/image/".concat(n))}},[e,F,I,null==q?void 0:q.limits,W,E]),ev=l.useCallback((e,t)=>{U(!0),V(t)},[]),ep=l.useCallback(()=>{N(),A(!1),z(void 0)},[N]),eg=!!(null==F?void 0:F.uid)&&!!t&&((null==F?void 0:null===(j=F.access)||void 0===j?void 0:j.edit_any_board)||"user"===t.owner.type&&t.owner.id===(null==F?void 0:F.uid)||!!P&&"team"===t.owner.type&&t.owner.id===P.id),ef=l.useCallback(()=>{z(void 0),U(!1),V(null)},[]);return l.useMemo(()=>({onImageClick:ei,canDeleteFromProject:eg,onSaveClick:eo,onDotsMenuClick:er,onDeleteFromProjectClick:eu,onFavoriteClick:ea,onPinterestClick:ed,onAdjustmentClick:es,favorites:K,showEditRestrictedModal:O,closeModal:ep,onDownloadClick:ec,imageToDownload:G,closeDrawer:ef,onShareClick:ev,shareImage:X,shareDrawer:H}),[ei,eg,eo,er,eu,ea,ed,es,K,ep,ec,G,ef,ev,X,H,O])}},31972:function(e,t,n){n.d(t,{Mm:function(){return i},b7:function(){return l},jB:function(){return a},pF:function(){return o}});let l=96,i=300,a=150,o=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"px",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"px",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l,o="number"==typeof e?e:parseFloat(e),r="number"==typeof t?t:parseFloat(t);if(n===i)return[o,r];let u=a/2.54,d=null;switch(n){case"in":d=[o*a,r*a];break;case"cm":d=[o*u,r*u];break;case"px":d=[o,r];break;default:throw Error("Invalid unit value ".concat(n))}let[s,c]=d;switch(i){case"in":return[s/a,c/a];case"cm":return[s/u,c/u];case"px":return d;default:throw Error("Invalid unit value ".concat(i))}}},65118:function(e,t,n){n.d(t,{O:function(){return l},u:function(){return o}});let l=e=>{window.location.assign(e)},i=null,a=()=>{if("boolean"==typeof i)return i;if("undefined"==typeof ReadableStream||"undefined"==typeof Request||"undefined"==typeof Blob||"function"!=typeof new Blob().arrayBuffer)return i=!1;try{let e=!1,t=new Request("",{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");i=e&&!t}catch(e){i=!1}return i};async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];{if(!t||(null==t?void 0:t.length)===0||!a()){window.location.assign(e);return}let r=[e,...t],u=0,d=Date.now();for(;r.length>0&&Date.now()-d<3e4;){let a=Date.now(),s=r.shift(),c=null,v=null,p=null,g=new AbortController;g.signal.onabort=e=>{var t;return null==e?void 0:null===(t=e.preventDefault)||void 0===t?void 0:t.call(e)};let f=setTimeout(()=>{g.signal.aborted||g.abort("Timeout. Download url is not reachable: "+s)},6500);try{(null==(c=await fetch(s,{method:"GET",signal:g.signal,credentials:"omit"}))?void 0:c.ok)||(p=!1,console.warn({message:"File connection failed ".concat(e,": ").concat(c.status," ").concat(c.statusText)}))}catch(t){g.signal.aborted?console.debug("Aborted. Timeout."):console.warn({message:"File connection failed ".concat(e,": ").concat(t.message),ok:null==c?void 0:c.ok,status:null==c?void 0:c.status}),p=!1}if(!1===p){try{clearTimeout(f),g.signal.aborted||g.abort("Done.")}catch(e){}u+=1;continue}if(!g.signal.aborted&&(null==c?void 0:c.ok)&&(null==c?void 0:c.status)===200){if(u>0||Date.now()-a>5e3)p=!0,console.debug("File connection ok. ".concat(0===u?"Triggered the original download url request, no test connection too slow. ".concat(Date.now()-a," ms."):"Triggering a mirror download url request. ".concat(Date.now()-a," ms, ").concat(u,"/").concat(t.length," mirror attempts.")));else{var n,l,i,o;let t=!c.body.locked&&(null==c?void 0:null===(l=c.body)||void 0===l?void 0:null===(n=l.getReader)||void 0===n?void 0:n.call(l));try{v=await t.read()}catch(n){console.warn({message:"File read failed ".concat(e,": ").concat(c.status," ").concat(c.statusText),error:n.message}),null==t||null===(o=t.cancel)||void 0===o||o.call(t).catch()}(null==v?void 0:null===(i=v.value)||void 0===i?void 0:i.byteLength)>1e3&&(p=!0,console.debug("File readable. Triggered the original download url request. ".concat(Date.now()-a," ms.")))}try{clearTimeout(f),g.signal.aborted||g.abort("Done.")}catch(e){}if(!0===p){console.debug("Triggered after ".concat(Date.now()-d," ms.")),window.location.assign(e);return}}u+=1}window.location.assign(e)}}}}]);